<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="keywords" content="GNU, Linux, Debian, Jessie, 8, Airtime, Icecast, Apache">
    <meta name="description" content="Setting up an internet radio station on Debian Jessie with Airtime and Icecast 2.">
    <title>Creating an internet radio station.</title>
  </head>
  <body>
<pre>
<b>Creating an internet radio station on Debian 8 with Airtime and Icecast 2.</b>

<b>Contents:</b>
1.  <a href="#1">Prerequisites</a>
2.  <a href="#2">Installation</a>
3.  <a href="#3">Testing and additional configuration</a>

<b>Prerequisites</b><a name="1"></a>

1. System with at least 512 MB RAM, 1 GHz CPU, 5 Gb free disk space;
2. Clean Debian 8.6 installation (from netinstall amd64 iso, with only ssh
   server and standard system utilities, of course without desktop
   environment);
3. One available IP address;
4. Domain names "copypasta.fm" and "airtime.copypasta.fm" (I will use
   these domains) pointing to this IP address (for testing you can use
   local ip address and appropriate records in the hosts file).

<b>Installation</b><a name="2"></a>

As you <a href="https://sourcefabric.booktype.pro/airtime-25-for-broadcasters/preparing-the-server/">can see</a>: "The recommended Airtime server platform is Debian 7.2
'wheezy'". But actually you can install Airtime on Debian 8.6 'Jessie', I
will show you how.

1. Open /etc/apt/sources.list and append this:

   deb http://apt.sourcefabric.org/ wheezy main

2. apt-get update

   You will see this error: "W: GPG error: http://apt.sourcefabric.org
   wheezy InRelease: The following signatures couldn't be verified because
   the public key is not available: NO_PUBKEY 0888FE5B174C1854". We will
   fix this.

3. apt-get install sourcefabric-keyring

   On the question "Install these packages without verification? [y/N]"
   type "y" and press Enter.

4. Update your computer's software sources again:

   apt-get update

5. apt-get install gdebi

   Press Enter.

6. wget https://grez911.github.io/files/mp3gain_1.5.2-r2-6_amd64.deb

7. gdebi mp3gain_1.5.2-r2-6_amd64.deb

   Type "y" and press Enter.

8. wget https://apt.sourcefabric.org/misc/airtime-easy-setup.deb

9. gdebi airtime-easy-setup.deb

   Type "y" and press Enter. On question "Configure Icecast2?" choose "No".
   We will configure it manually later.

10. apt-get update

    Probably you will see error "W: Failed to fetch
    http://apt.sourcefabric.org/dists/squeeze/main/binary-amd64/Packages
    404  Not Found [IP: 144.76.185.238 80]
    E: Some index files failed to download. They have been ignored, or old
    ones used instead.", but it's OK.

11. apt-get install airtime

    Press Enter.

12. /var/lib/airtime/tmp/install_minimal/airtime-install -d

    You'll see some warnings, but it's OK.

13. Open /etc/icecast2/icecast.xml and change this to your domain name:

    &lt;hostname&gt;copypasta.fm&lt;/hostname&gt;

    Save file and exit.

14. Restart Icecast:

    /etc/init.d/icecast2 restart  

15. Open /etc/apache2/sites-available/airtime-vhost.conf and change:

    ServerName airtime.copypasta.fm (in two places)

    Redirect permanent /login https://airtime.copypasta.fm/login

    Save file and exit.

16. Restart Apache:

    killall -HUP apache2

<b>Testing and additional configuration</b><a name="3"></a>

Now you can reach Airtime admin panel at https://airtime.copypasta.fm/
You will see error message "The certificate is not trusted because it is
self-signed". It's OK, you can install other certificate later if you want.
Now you can login with "admin/admin" pair and start using Airtime with
<a href="https://sourcefabric.booktype.pro/airtime-25-for-broadcasters/what-is-airtime/">instructions</a> from the official website.

You can see Icecast status at http://copypasta.fm:8000/ (for "Admin Home"
tab use "admin/donthackme" pair). You must change the default passwords in
the /etc/icecast2/icecast.xml file. Don't forget set this passwords in the
Airtime <a href="https://sourcefabric.booktype.pro/airtime-25-for-broadcasters/stream-settings/">output stream settings</a>.

You can listen to your stream at http://copypasta.fm:8000/airtime_128 (it
will be empty if you haven't <a href="https://sourcefabric.booktype.pro/airtime-25-for-broadcasters/calendar/">created a show</a>).

After this you probably want to create your radio station main page. Create
a new config for Apache /etc/apache2/sites-available/copypasta.fm.conf
Write in this file the following:

&lt;VirtualHost *:80&gt;
      ServerName copypasta.fm
      ServerAlias www.copypasta.fm

      DocumentRoot /home/user/www/
      DirectoryIndex index.php

      &lt;Directory /home/user/www&gt;
              AllowOverride all
              Require all granted
      &lt;/Directory&gt;
&lt;/VirtualHost&gt;

Change /home/user/www path with the path where your radio site will be. In
my case the file /home/user/www/index.php contains the following:

&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;copypasta.fm&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;audio controls&gt;
      &lt;source src="http://copypasta.fm:8000/airtime_128" type="audio/ogg"&gt;
      Your browser does not support the audio element.
    &lt;/audio&gt;
  &lt;/body&gt;
&lt;/html&gt;

After creating config, enable this site:

a2ensite copypasta.fm.conf

Reload Apache:

killall -HUP apache2

Now you can listen to your radio at http://copypasta.fm/

If you want that your stream also be available at the port 443 and be
encrypted, i.e. https://copypasta.fm/airtime_128, than do the following:

1. a2enmod proxy_http

2. Open /etc/apache2/sites-enabled/copypasta.fm.conf, delete all and write
   this:

&lt;VirtualHost *:443&gt;
      SSLEngine on
      SSLProtocol all -SSLv2
      SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
      SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key
      Header always set Strict-Transport-Security "max-age=31536000"

      ServerName copypasta.fm
      ServerAlias www.copypasta.fm

      DocumentRoot /home/user/www/
      DirectoryIndex index.php

      &lt;Directory /home/user/www&gt;
              AllowOverride all
              Require all granted
      &lt;/Directory&gt;

      ProxyPass /airtime_128 http://127.0.0.1:8000/airtime_128
      ProxyPassReverse /airtime_128 http://127.0.0.1:8000/airtime_128
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
      ServerName copypasta.fm
      ServerAlias www.copypasta.fm

      DocumentRoot /home/user/www/
      DirectoryIndex index.php

      &lt;Directory /home/user/www>
              AllowOverride all
              Require all granted
      &lt;/Directory&gt;

      Redirect permanent / https://copypasta.fm/
&lt;/VirtualHost&gt;

3. Restart Apache:

   killall -HUP apache2

4. Open /home/user/www/index.php and replace all content with this:

&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;copypasta.fm&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;audio controls&gt;
      &lt;source src="https://copypasta.fm/airtime_128" type="audio/ogg"&gt;
      Your browser does not support the audio element.
    &lt;/audio&gt;
  &lt;/body&gt;
&lt;/html&gt;

Now you can listen your radio at https://copypasta.fm/ without error about
mixed encrypted and unencrypted content. Your stream will be available at
https://copypasta.fm/airtime_128 and http://copypasta.fm:8000/airtime_128
</pre>
  </body>
</html>
